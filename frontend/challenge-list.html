<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°™ì´ í•´ìš” - ì—ë„ˆì§€ ì ˆì•½ í”Œë«í¼</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .toolbar-card {
            border: 1px solid #e2e8f0;
            border-radius: 18px;
            padding: 18px;
            background: #f8fafc;
        }
        .toolbar-card .region-pill {
            border-radius: 999px;
            border: 1px solid #d0d5dd;
            padding: 9px 18px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .toolbar-card .region-pill:hover {
            border-color: #62a5ff;
            background-color: #ebf3ff;
        }
        .toolbar-card select {
            border-radius: 12px;
            padding: 10px 14px;
            font-weight: 500;
        }
        .toolbar-card .search-input {
            border-radius: 12px;
            padding: 12px 16px;
            border: 1px solid #d0d5dd;
            font-size: 0.95rem;
        }
        .activity-card {
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid #eef2f8;
            background: #ffffff;
            transition: transform 0.2s, box-shadow 0.2s;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .activity-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 18px 40px rgba(15, 23, 42, 0.08);
        }
        .activity-card .card-header-img {
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #1f2937;
        }
        .activity-card .badge-chip {
            background-color: #f1f5f9;
            color: #334155;
            border-radius: 999px;
            padding: 4px 10px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 6px;
            margin-bottom: 6px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .activity-card .meta-info {
            font-size: 0.85rem;
            color: #64748b;
            display: flex;
            justify-content: space-between;
            margin-top: auto;
            align-items: center;
        }
        .activity-card .meta-info .points {
            color: #16a34a;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold text-primary" href="index.html">âš¡ ì—ë„ˆì§€ì ˆì•½</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.html">ëŒ€ì‹œë³´ë“œ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="challenge.html">ì±Œë¦°ì§€</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="ranking.html">ë­í‚¹</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="programs.html">ì§€ì›ì‚¬ì—…</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="mypage.html">ë§ˆì´í˜ì´ì§€</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container py-5">
        <div class="row mb-4">
            <div class="col-lg-8">
                <h2 class="fw-bold mb-3">ê°™ì´ í•´ìš”</h2>
                <p class="text-muted mb-0">ì‹¤ì‹œê°„ìœ¼ë¡œ ëª¨ì§‘ ì¤‘ì¸ í™˜ê²½ë³´í˜¸ í™œë™ì„ í™•ì¸í•˜ê³  í¬ì¸íŠ¸ë„ í•¨ê»˜ ëª¨ì•„ë³´ì„¸ìš”.</p>
            </div>
        </div>

        <div class="toolbar-card mb-4">
            <div class="d-flex flex-column flex-lg-row align-items-lg-center gap-3">
                <div class="d-flex flex-wrap gap-2 align-items-center">
                    <button class="region-pill" type="button" id="regionButton">
                        <span>ğŸ“</span>
                        <span id="regionLabel">ì„œìš¸ ê´€ì•…êµ¬ ë‚¨í˜„ë™</span>
                    </button>
                    <select id="distanceSelect" class="form-select form-select-sm" style="max-width: 160px;">
                        <option value="all">ì •ë ¬ ì„ íƒ</option>
                        <option value="nearest">ê°€ê¹Œìš´ ìˆœ</option>
                        <option value="soon">ë§ˆê° ì„ë°•</option>
                        <option value="recent">ìµœì‹  ë“±ë¡</option>
                    </select>
                    <select id="typeSelect" class="form-select form-select-sm" style="max-width: 160px;">
                        <option value="all">í™œë™ ìœ í˜•</option>
                        <option value="offline">ì˜¤í”„ë¼ì¸</option>
                        <option value="online">ì˜¨ë¼ì¸</option>
                    </select>
                </div>
                <div class="flex-grow-1 position-relative">
                    <input type="search" id="searchInput" class="form-control search-input" placeholder="ê´€ì‹¬ìˆëŠ” í™˜ê²½ë³´í˜¸ í™œë™ì„ ê²€ìƒ‰í•´ë³´ì„¸ìš” :)">
                    <span class="position-absolute top-50 end-0 translate-middle-y pe-3 text-muted">ğŸ”</span>
                </div>
            </div>
        </div>

        <div class="row g-4" id="challengeList">
            <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
        </div>

        <div class="text-center mt-4">
            <button type="button" class="btn btn-outline-secondary px-4" id="loadMoreButton">ë”ë³´ê¸°</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        window.API_BASE_URL = window.API_BASE_URL || '';
    </script>
    <script src="js/common.js"></script>
    <script>
        const challenges = [
            {
                id: 'cleanup-1',
                title: 'ì“°ë‹´ëŸ° EP.6 ê±°ë¶ì„¬ë™',
                tags: ['#ì„œìš¸', '#í”Œë¡œê¹…', '#ì¶”ì²œ'],
                location: 'ê²½ê¸° ì‹œí¥ì‹œ ì •ì™•ë™',
                dday: 4,
                reward: 1000,
                participants: 6,
                mode: 'offline',
                distanceKm: 2.4,
                deadlineDate: '2025-11-15',
                registeredAt: '2025-11-01',
                imageEmoji: 'ğŸŒ¿',
                summary: 'ë„ì‹œ ì“°ë ˆê¸° ì¤ê¸° ìº í˜ì¸ìœ¼ë¡œ 11ì›” 15ì¼ì— ì§„í–‰ë©ë‹ˆë‹¤.'
            },
            {
                id: 'green-supporter-2025',
                title: '2025ë…„ ê·¸ë¦°ì„œí¬í„°ì¦ˆ í™˜ê²½ í–‰ë™ë‹¨',
                tags: ['#ì„œìš¸', '#ì²­ì†Œë…„', '#ì§€ì›í™œë™'],
                location: 'ì„œìš¸ ì„œì´ˆêµ¬ ë°©ë°°ë™',
                dday: 1,
                reward: 1000,
                participants: 0,
                mode: 'offline',
                distanceKm: 4.1,
                deadlineDate: '2025-11-12',
                registeredAt: '2025-10-28',
                imageEmoji: 'ğŸŒ±',
                summary: 'ì²­ì†Œë…„ í™˜ê²½ í–‰ë™ë‹¨ì„ ëª¨ì§‘í•©ë‹ˆë‹¤.'
            },
            {
                id: 'eco-jump-11',
                title: 'í•œë¹› ì¹œí™˜ê²½ ì¤ê¹…ìº í˜ì¸ 11ì›” ì°¸ì—¬ì ëª¨ì§‘',
                tags: ['#ì–‘ì²œêµ¬', '#ì¹œí™˜ê²½ìº í˜ì¸', '#ê¹”ë”í•œë™ë„¤'],
                location: 'ì„œìš¸ ì–‘ì²œêµ¬ ì‹ ì›”ë™',
                dday: 1,
                reward: 1000,
                participants: 0,
                mode: 'offline',
                distanceKm: 5.8,
                deadlineDate: '2025-11-12',
                registeredAt: '2025-10-30',
                imageEmoji: 'ğŸŒ',
                summary: 'ì¤ê¹…ìœ¼ë¡œ ìš°ë¦¬ ë™ë„¤ë¥¼ ê¹¨ë—í•˜ê²Œ ê°€ê¿”ë³´ì„¸ìš”.'
            },
            {
                id: 'school-recycle',
                title: 'ì¥ë‚œê°ì¬í™œìš© ìì›ë´‰ì‚¬',
                tags: ['#ê²½ê¸°ë„', '#êµìœ¡ë´‰ì‚¬', '#ì¬í™œìš©'],
                location: 'ê²½ê¸° ê³ ì–‘ì‹œ ì¼ì‚°ë™êµ¬ ì„±ì„ë™',
                dday: 11,
                reward: 1000,
                participants: 2,
                mode: 'offline',
                distanceKm: 12.5,
                deadlineDate: '2025-11-21',
                registeredAt: '2025-11-03',
                imageEmoji: 'ğŸ§¸',
                summary: 'ì¬í™œìš© ì¥ë‚œê°ì„ ì •ë¦¬í•˜ê³  ë‚˜ëˆ”í•˜ëŠ” ë´‰ì‚¬í™œë™ì…ë‹ˆë‹¤.'
            },
            {
                id: 'district-clean',
                title: 'ê²½ì•ˆì²œ ì£¼ë³€ ì •í™”í™œë™',
                tags: ['#ìš©ì¸ì‹œ', '#í•˜ì²œì •í™”', '#ì£¼ë§í™œë™'],
                location: 'ê²½ê¸° ìš©ì¸ì‹œ ì²˜ì¸êµ¬ ê¹€ëŸ‰ì¥ë™',
                dday: 2,
                reward: 1000,
                participants: 0,
                mode: 'offline',
                distanceKm: 9.3,
                deadlineDate: '2025-11-13',
                registeredAt: '2025-10-25',
                imageEmoji: 'ğŸ’§',
                summary: 'í•˜ì²œ ì£¼ë³€ ì“°ë ˆê¸°ë¥¼ í•¨ê»˜ ì¹˜ìš°ëŠ” ì •í™”í™œë™ì…ë‹ˆë‹¤.'
            },
            {
                id: 'online-energy-class',
                title: '2025 ì•„ë„ˆìŠ¤, ê·¸ë¦°ë¯¸ì¶”í™€ ìì›ìˆœí™˜ í”Œëœ',
                tags: ['#ì˜¨ë¼ì¸', '#ìì›ìˆœí™˜', '#êµìœ¡'],
                location: 'ì˜¨ë¼ì¸ ë¼ì´ë¸Œ',
                dday: 0,
                reward: 1000,
                participants: 0,
                mode: 'online',
                distanceKm: 0.5,
                deadlineDate: '2025-11-11',
                registeredAt: '2025-11-05',
                imageEmoji: 'ğŸ’»',
                summary: 'ì˜¨ë¼ì¸ìœ¼ë¡œ ì°¸ì—¬í•˜ëŠ” ìì›ìˆœí™˜ êµìœ¡ í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤.'
            },
            {
                id: 'battery-recycle',
                title: '11ì›” ìœ„ê¸°ë¥¼ ê¸°íšŒë¡œ - ë¦¬ì‹¸ì´í´ë§ ìº í˜ì¸',
                tags: ['#ì¸ì²œ', '#ë¦¬ì‹¸ì´í´ë§', '#ìƒí™œí™˜ê²½'],
                location: 'ì¸ì²œ ì„œêµ¬ ë§ˆì „ë™',
                dday: 2,
                reward: 1000,
                participants: 0,
                mode: 'offline',
                distanceKm: 18.2,
                deadlineDate: '2025-11-13',
                registeredAt: '2025-10-20',
                imageEmoji: 'ğŸ”‹',
                summary: 'íê±´ì „ì§€ ëª¨ì•„ ì¬í™œìš©í•˜ëŠ” ì‹œë¯¼ ì°¸ì—¬ ìº í˜ì¸ì…ë‹ˆë‹¤.'
            },
            {
                id: 'community-garden',
                title: 'ê³µì› ì •ì›ì‚¬ì™€ í•¨ê»˜í•˜ëŠ” ë„ì‹œ í…ƒë°­ ê°€ê¾¸ê¸°',
                tags: ['#ë„ì‹œë†ì—…', '#ê°€ì¡±í™œë™', '#ì²´í—˜'],
                location: 'ì„œìš¸ ë™ì‘êµ¬ ìƒë„ë™',
                dday: 7,
                reward: 1000,
                participants: 5,
                mode: 'offline',
                distanceKm: 3.6,
                deadlineDate: '2025-11-18',
                registeredAt: '2025-11-04',
                imageEmoji: 'ğŸŒ¼',
                summary: 'ë„ì‹œ ê³µì›ì„ í•¨ê»˜ ê°€ê¾¸ëŠ” ì²´í—˜í˜• ë´‰ì‚¬í™œë™ì…ë‹ˆë‹¤.'
            }
        ];

        let visibleCount = 8;

        function calculateDDay(endDate) {
            if (!endDate) return 'ì§„í–‰ì¤‘';
            const end = new Date(endDate);
            const today = new Date();
            end.setHours(0, 0, 0, 0);
            today.setHours(0, 0, 0, 0);
            const diff = Math.ceil((end - today) / (1000 * 60 * 60 * 24));
            if (Number.isNaN(diff)) return 'ì§„í–‰ì¤‘';
            if (diff > 0) return `D-${diff}`;
            if (diff === 0) return 'D-DAY';
            return 'ì¢…ë£Œ';
        }

        function getSortedList(list) {
            const distanceSelect = document.getElementById('distanceSelect');
            if (!distanceSelect) return list;

            const value = distanceSelect.value;
            if (value === 'nearest') {
                return [...list].sort((a, b) => (a.distanceKm || 999) - (b.distanceKm || 999));
            }
            if (value === 'soon') {
                return [...list].sort((a, b) => {
                    const aDiff = a.deadlineDate ? new Date(a.deadlineDate) - new Date() : Infinity;
                    const bDiff = b.deadlineDate ? new Date(b.deadlineDate) - new Date() : Infinity;
                    return aDiff - bDiff;
                });
            }
            if (value === 'recent') {
                return [...list].sort((a, b) => {
                    const aRegistered = a.registeredAt ? new Date(a.registeredAt) : new Date(0);
                    const bRegistered = b.registeredAt ? new Date(b.registeredAt) : new Date(0);
                    return bRegistered - aRegistered;
                });
            }
            return list;
        }

        function filterChallenges() {
            const typeSelect = document.getElementById('typeSelect');
            const searchInput = document.getElementById('searchInput');

            let filtered = [...challenges];

            if (typeSelect && typeSelect.value !== 'all') {
                filtered = filtered.filter(item => item.mode === typeSelect.value);
            }

            if (searchInput && searchInput.value.trim()) {
                const keyword = searchInput.value.trim().toLowerCase();
                filtered = filtered.filter(item => {
                    const haystack = [
                        item.title,
                        item.location,
                        item.summary,
                        ...(item.tags || [])
                    ].join(' ').toLowerCase();
                    return haystack.includes(keyword);
                });
            }

            return getSortedList(filtered);
        }

        function renderChallenges(list) {
            const container = document.getElementById('challengeList');
            if (!container) return;

            if (!list || list.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center text-muted py-5">
                        ì¡°ê±´ì— ë§ëŠ” í™œë™ì´ ì—†ì–´ìš”. ë‹¤ë¥¸ í‚¤ì›Œë“œë¥¼ ê²€ìƒ‰í•´ë³´ì„¸ìš”.
                    </div>
                `;
                document.getElementById('loadMoreButton').classList.add('d-none');
                return;
            }

            const limited = list.slice(0, visibleCount);
            container.innerHTML = limited.map(item => {
                const badgeLabel = item.dday <= 3 ? 'ë§ˆê°ì„ë°•' : item.dday <= 7 ? 'ì¶”ì²œ' : 'ëª¨ì§‘ì¤‘';
                const cardGradient = item.mode === 'online'
                    ? 'linear-gradient(135deg, #bbf0ff 0%, #80d0c7 100%)'
                    : 'linear-gradient(135deg, #9face6 0%, #74ebd5 100%)';

                return `
                    <div class="col-xl-3 col-lg-4 col-md-6">
                        <div class="activity-card">
                            <div class="card-header-img" style="background:${cardGradient};">
                                ${item.imageEmoji || 'ğŸŒ¿'}
                            </div>
                            <div class="p-3 p-lg-4 d-flex flex-column">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="badge bg-warning text-dark fw-semibold">${badgeLabel}</span>
                                    <span class="text-primary fw-bold">${calculateDDay(item.deadlineDate)}</span>
                                </div>
                                <div class="mb-3">
                                    ${(item.tags || []).map(tag => `<span class="badge-chip">${tag}</span>`).join('')}
                                </div>
                                <h6 class="fw-bold mb-2">${item.title}</h6>
                                <p class="text-muted small mb-0">${item.location}</p>
                                <p class="text-muted small mt-2 mb-3">${item.summary}</p>
                                <div class="meta-info">
                                    <span class="points">ğŸ’ ${(item.reward || 0).toLocaleString()} P</span>
                                    <span>ì‹ ì²­ì ${item.participants || 0}ëª…</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            const loadMoreButton = document.getElementById('loadMoreButton');
            if (limited.length >= list.length) {
                loadMoreButton.classList.add('d-none');
            } else {
                loadMoreButton.classList.remove('d-none');
            }
        }

        function refreshList() {
            const filtered = filterChallenges();
            renderChallenges(filtered);
        }

        document.getElementById('distanceSelect').addEventListener('change', refreshList);
        document.getElementById('typeSelect').addEventListener('change', refreshList);
        document.getElementById('searchInput').addEventListener('input', () => {
            visibleCount = 8;
            refreshList();
        });
        document.getElementById('loadMoreButton').addEventListener('click', () => {
            visibleCount += 8;
            refreshList();
        });
        document.getElementById('regionButton').addEventListener('click', () => {
            alert('ì§€ì—­ ì„ íƒ ê¸°ëŠ¥ì€ ê³§ ì œê³µë  ì˜ˆì •ì…ë‹ˆë‹¤.');
        });

        refreshList();
    </script>
</body>
</html>


