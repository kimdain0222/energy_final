<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—ë„ˆì§€ ë¶„ì„ - ì—ë„ˆì§€ ì ˆì•½ í”Œë«í¼</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold text-primary" href="index.html">âš¡ ì—ë„ˆì§€ì ˆì•½</a>
            <a href="dashboard.html" class="text-muted">â† ëŒ€ì‹œë³´ë“œë¡œ</a>
        </div>
    </nav>

    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <h2 class="fw-bold mb-4">ì—ë„ˆì§€ ë¶„ì„</h2>
                <p class="text-muted mb-5">1ë¶„ ì§„ë‹¨ìœ¼ë¡œ ìš°ë¦¬ì§‘ ì „ê¸°ì‚¬ìš©ëŸ‰ì„ ê°„í¸í•˜ê²Œ ë¹„êµí•´ë³´ì„¸ìš”</p>

                <!-- ë¹ ë¥¸ ì§„ë‹¨ -->
                <div class="card mb-4 border-0 shadow-sm">
                    <div class="card-body p-4">
                        <div class="quick-analysis-section">
                            <h3 class="fw-bold mb-2">ğŸ” 1ë¶„ ì§„ë‹¨: ìš°ë¦¬ì§‘ ì „ê¸°ì‚¬ìš©ëŸ‰ ì²´í¬</h3>
                            <p class="text-muted mb-4">ì•„ë˜ ìœ í˜• ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ë©´ í‰ê·  ê°€êµ¬ì™€ ë¹„êµí•´ë“œë ¤ìš”</p>

                            <div class="row g-3 housing-type-cards" id="demoSamples">
                                <div class="col-md-4">
                                    <div class="housing-card demo-sample p-4 border rounded h-100 text-center"
                                         role="button" tabindex="0"
                                         data-type="ì•„íŒŒíŠ¸" data-area="84" data-usage="350">
                                        <div class="icon fs-1 mb-2">ğŸ¢</div>
                                        <h4 class="fw-bold mb-2">ì•„íŒŒíŠ¸</h4>
                                        <p class="avg-info text-muted mb-1">í‰ê·  84ã¡ Â· ì›” 350kWh</p>
                                        <p class="comparison text-primary mb-0">í‰ê·  ê°€êµ¬ì™€ ë¹„êµí•˜ê¸°</p>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <div class="housing-card demo-sample p-4 border rounded h-100 text-center"
                                         role="button" tabindex="0"
                                         data-type="ë‹¨ë…ì£¼íƒ" data-area="99" data-usage="480">
                                        <div class="icon fs-1 mb-2">ğŸ </div>
                                        <h4 class="fw-bold mb-2">ë‹¨ë…ì£¼íƒ</h4>
                                        <p class="avg-info text-muted mb-1">í‰ê·  99ã¡ Â· ì›” 480kWh</p>
                                        <p class="comparison text-primary mb-0">í‰ê·  ê°€êµ¬ì™€ ë¹„êµí•˜ê¸°</p>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <div class="housing-card demo-sample p-4 border rounded h-100 text-center"
                                         role="button" tabindex="0"
                                         data-type="ì˜¤í”¼ìŠ¤í…”" data-area="33" data-usage="200">
                                        <div class="icon fs-1 mb-2">ğŸ™ï¸</div>
                                        <h4 class="fw-bold mb-2">ì˜¤í”¼ìŠ¤í…”</h4>
                                        <p class="avg-info text-muted mb-1">í‰ê·  33ã¡ Â· ì›” 200kWh</p>
                                        <p class="comparison text-primary mb-0">í‰ê·  ê°€êµ¬ì™€ ë¹„êµí•˜ê¸°</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì§ì ‘ ì…ë ¥ í¼ -->
                <div class="card border-0 shadow-sm">
                    <div class="card-body p-5">
                        <h5 class="fw-bold mb-4">ë˜ëŠ” ì§ì ‘ ì…ë ¥</h5>
                        <form id="analyzeForm">
                            <div class="mb-4">
                                <label for="houseType" class="form-label">ì£¼íƒ ìœ í˜•</label>
                                <select class="form-select" id="houseType" required>
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="ì•„íŒŒíŠ¸">ì•„íŒŒíŠ¸</option>
                                    <option value="ë‹¨ë…ì£¼íƒ">ë‹¨ë…ì£¼íƒ</option>
                                    <option value="ì˜¤í”¼ìŠ¤í…”">ì˜¤í”¼ìŠ¤í…”</option>
                                </select>
                            </div>

                            <div class="mb-4">
                                <label for="area" class="form-label">ë©´ì  (ã¡)</label>
                                <input type="number" class="form-control" id="area" placeholder="ì˜ˆ: 84" required>
                            </div>

                            <div class="mb-4">
                                <label for="monthlyUsage" class="form-label">ì›” ì „ê¸° ì‚¬ìš©ëŸ‰ (kWh)</label>
                                <input type="number" class="form-control" id="monthlyUsage" placeholder="ì˜ˆ: 350" required>
                                <small class="text-muted">ì „ê¸° ìš”ê¸ˆ ê³ ì§€ì„œì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤</small>
                            </div>

                            <button type="submit" class="btn btn-primary btn-lg w-100">
                                ì‹¤ì œ ì§€ì›ì‚¬ì—… ì°¾ê¸°
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        window.API_BASE_URL = window.API_BASE_URL || '';
    </script>
    <script src="js/common.js"></script>
    <script>
        // ë°ëª¨ ìƒ˜í”Œ í´ë¦­
        document.querySelectorAll('.demo-sample').forEach(card => {
            const selectSample = () => {
                document.getElementById('houseType').value = card.dataset.type || '';
                document.getElementById('area').value = card.dataset.area || '';
                document.getElementById('monthlyUsage').value = card.dataset.usage || '';
            };

            card.style.cursor = 'pointer';
            card.addEventListener('click', selectSample);
            card.addEventListener('keydown', (event) => {
                if (event.key === 'Enter' || event.key === ' ') {
                    event.preventDefault();
                    selectSample();
                }
            });
        });

        // ë¶„ì„ í¼ ì œì¶œ
        document.getElementById('analyzeForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const user = JSON.parse(localStorage.getItem('user') || '{}');
            const houseType = document.getElementById('houseType').value;
            const area = parseInt(document.getElementById('area').value);
            const monthlyUsage = parseInt(document.getElementById('monthlyUsage').value);

            // ë¶„ì„ ê²°ê³¼ë¥¼ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•˜ê³  ê²°ê³¼ í˜ì´ì§€ë¡œ ì´ë™
            try {
                const response = await fetch(getApiUrl('/api/analyze'), {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        houseType, 
                        area, 
                        monthlyUsage,
                        userId: user.id // í‹°ì–´ ì €ì¥ì„ ìœ„í•´ userId ì „ë‹¬
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸ (í‹°ì–´ ì •ë³´)
                    if (user.id && data.analysis.tier) {
                        user.energyTier = data.analysis.tier;
                        localStorage.setItem('user', JSON.stringify(user));
                    }
                    
                    localStorage.setItem('analysisResult', JSON.stringify({
                        houseType,
                        area,
                        monthlyUsage,
                        ...data.analysis
                    }));
                    window.location.href = 'results.html';
                } else {
                    alert('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                alert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        });
    </script>
</body>
</html>

